---
import { getCollection, render } from "astro:content";
import MDLayout from "@layouts/MDLayout.astro";
import { slugFromFilePath } from "../../utils";
import Separator from "@components/Separator.astro";

export async function getStaticPaths() {
	let posts = await getCollection("posts");

	return posts.map((post) => {
		const slug = slugFromFilePath(post.filePath || "");

		return {
			params: { slug },
			props: { post },
		};
	});
}

const { post } = Astro.props;

const date = new Date(post.data.pubDate);
const fullDate = date.toLocaleDateString("en-us", {
	year: "numeric",
	month: "long",
	day: "numeric",
});

const { Content } = await render(post);
---

<MDLayout
	frontmatter={{
		title: post.data.title,
		backUrl: "/posts/",
	}}
>
	<h1 class="font-bold text-3xl mb-0">{post.data.title}</h1>
	<time class="text-sm opacity-50! !-mt-6" datetime={fullDate}>
		{fullDate}
	</time>

	<Separator />

	<Content />

	<Separator />

	<script
		src="https://giscus.app/client.js"
		data-repo="amrbashir/amrbashir.me"
		data-repo-id="R_kgDOMKJUBw"
		data-category="Announcements"
		data-category-id="DIC_kwDOMKJUB84C1YXr"
		data-mapping="title"
		data-strict="1"
		data-reactions-enabled="1"
		data-emit-metadata="0"
		data-input-position="top"
		data-theme="transparent_dark"
		data-lang="en"
		data-loading="lazy"
		crossorigin="anonymous"
		async></script>
</MDLayout>
