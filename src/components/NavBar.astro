---
import Logo from "./Logo.astro";
import GitHubIcon from "~icons/ri/github-line";
import TwitterIcon from "~icons/ri/twitter-x-line";
import MoonIcon from "~icons/ri/moon-line";
import SunIcon from "~icons/ri/sun-line";
import LightBulbIcon from "~icons/ri/lightbulb-line";
---

<script>
	const darkModeToggle: HTMLElement | null = document.querySelector("#dark-mode-toggle");
	const htmlElement = document.querySelector("html");

	const isDarkMode = (theme: string | null) =>
		theme ? theme === "dark" : window.matchMedia("(prefers-color-scheme: dark)").matches;

	const changeDarkModeToggle = (isDark: boolean) => {
		if (isDark) {
			darkModeToggle?.children[0].classList.remove("hidden");
			darkModeToggle?.children[1].classList.add("hidden");
		} else {
			darkModeToggle?.children[0].classList.add("hidden");
			darkModeToggle?.children[1].classList.remove("hidden");
		}
	};

	const theme = localStorage.getItem("theme");
	const isDark = isDarkMode(theme);

	changeDarkModeToggle(isDark);

	if (isDark) {
		htmlElement?.classList.add("dark");
	}

	const toggle = () => {
		const theme = localStorage.getItem("theme");
		const currentlyDark = isDarkMode(theme);

		localStorage.setItem("theme", currentlyDark ? "light" : "dark");

		currentlyDark ? htmlElement?.classList.remove("dark") : htmlElement?.classList.add("dark");

		changeDarkModeToggle(!currentlyDark);
	};

	darkModeToggle?.addEventListener("click", toggle);
	darkModeToggle?.addEventListener("keypress", (e) => {
		if (e.key === "Enter") {
			toggle();
		}
	});
</script>

<nav>
	<div>
		<a class="home" href="/" aria-label="Home">
			<Logo />
		</a>
	</div>
	<div class="links">
		<a href="/projects" title="Projects">
			<LightBulbIcon />
			Projects
		</a>
		<a href="https://github.com/amrbashir" target="_blank" title="GitHub">
			<GitHubIcon />
			GitHub
		</a>
		<a href="https://x.com/amrbashir_dev" target="_blank" title="Twitter">
			<TwitterIcon />
			Twitter
		</a>
		<div tabindex="0" role="button" id="dark-mode-toggle" title="Toggle color scheme">
			<MoonIcon />
			<SunIcon class:list={"hidden"} />
		</div>
	</div>
</nav>

<style>
	nav {
		width: 100%;
		height: 5rem;
		padding: 0 2rem;
		overflow: hidden;
		display: flex;
		justify-content: space-between;
		align-items: center;
	}

	.links {
		display: flex;
		align-items: center;
		gap: 0.1rem;
	}

	a,
	div[role="button"] {
		text-decoration: none;
		display: flex;
		align-items: center;
		gap: 0.2rem;
		color: var(--color);
		opacity: 0.6;
		border-radius: 500rem;
		padding: 0.5rem;
	}

	a:hover,
	div[role="button"]:hover,
	a:focus-visible,
	div[role="button"]:focus-visible {
		opacity: 1;
	}

	#dark-mode-toggle {
		justify-content: center;
		cursor: pointer;
	}

	.hidden {
		display: none;
	}
</style>
